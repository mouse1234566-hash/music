<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ê³ ë“±ìˆ˜í•™ ìˆ˜ì—… ë„ìš°ë¯¸</title>
  <!-- ìˆ˜ì‹ ë Œë”ë§ìš© (ì„ íƒ) -->
  <script>
    // MathJaxëŠ” ë„¤íŠ¸ì›Œí¬ê°€ ë  ë•Œë§Œ ë¡œë“œí•©ë‹ˆë‹¤. (ì˜¤í”„ë¼ì¸ í™˜ê²½ì—ì„œë„ ì•±ì€ ì‘ë™)
    (function(){
      var s = document.createElement('script');
      s.src = 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      s.async = true; document.head.appendChild(s);
      window.MathJax = {tex: {inlineMath: [['$','$'], ['\\(','\\)']]} };
    })();
  </script>
  <style>
    :root{
      --bg:#0b1020; /* ë”¥ ë¸”ë£¨ */
      --panel:#121835;
      --soft:#1b2350;
      --accent:#8b9cff; /* ì—°ë³´ë¼ */
      --accent-2:#44d4c2;/* ë¯¼íŠ¸ */
      --text:#eef1ff;
      --muted:#9aa1c4;
      --ok:#2ecc71;
      --warn:#f39c12;
      --err:#e74c3c;
      --shadow: 0 10px 30px rgba(0,0,0,.3);
      --radius: 18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      color:var(--text); background:radial-gradient(1200px 800px at 80% -10%, #1a245e33, transparent), var(--bg);
    }
    header{
      position:sticky; top:0; z-index:10;
      display:flex; align-items:center; gap:14px; padding:14px 18px;
      background:linear-gradient(180deg, #0b1020cc, #0b102000);
      backdrop-filter: blur(8px);
      border-bottom:1px solid #ffffff14;
    }
    header .brand{display:flex; align-items:center; gap:10px}
    .logo{
      width:36px; height:36px; border-radius:12px; background:linear-gradient(135deg, var(--accent), var(--accent-2));
      box-shadow: var(--shadow);
    }
    h1{font-size:20px; margin:0; letter-spacing:.3px}
    .meta{margin-left:auto; display:flex; align-items:center; gap:8px; color:var(--muted)}
    .meta input{background:#ffffff10; border:none; padding:8px 10px; border-radius:10px; color:var(--text)}
    .container{display:grid; grid-template-columns: 290px 1fr; gap:18px; padding:18px;}
    aside{
      background:linear-gradient(180deg, var(--panel), #0f1430); border:1px solid #ffffff18; border-radius: var(--radius); padding:14px; box-shadow: var(--shadow);
      height: calc(100dvh - 100px); position: sticky; top: 82px; overflow:auto;
    }
    .section-btn{display:flex; align-items:center; gap:10px; width:100%; padding:12px 12px; background:#ffffff07; border:1px solid #ffffff10; border-radius:14px; color:var(--text); cursor:pointer; transition:.15s; margin-bottom:10px}
    .section-btn:hover{transform:translateY(-1px); background:#ffffff12}
    .section-btn.active{outline:2px solid var(--accent); background:#ffffff15}
    .badge{margin-left:auto; font-size:12px; color:var(--muted)}
    main{min-height:60vh}
    .card{
      background: linear-gradient(180deg, var(--panel), #0f1430);
      border:1px solid #ffffff18; border-radius: var(--radius); padding:18px; box-shadow: var(--shadow); margin-bottom:18px;
    }
    .grid{display:grid; gap:14px}
    .grid-2{grid-template-columns: repeat(2, 1fr)}
    .grid-3{grid-template-columns: repeat(3, 1fr)}
    @media (max-width: 980px){
      .container{grid-template-columns: 1fr}
      aside{position:relative; height:auto}
      .grid-2, .grid-3{grid-template-columns: 1fr}
    }
    h2{margin:0 0 8px 0; font-size:22px}
    h3{margin:0 0 6px 0; font-size:18px; color:#dfe4ff}
    p{color:var(--muted); margin:0 0 10px 0}
    label{font-size:13px; color:#cbd2ff}
    input, select, textarea, button{
      background:#0e1433; border:1px solid #ffffff22; color:var(--text); border-radius:12px; padding:10px; outline:none;
    }
    button{cursor:pointer; font-weight:600; letter-spacing:.2px}
    .btn{
      background:linear-gradient(135deg, var(--accent), var(--accent-2)); color:#0b1020; border:none; box-shadow: var(--shadow);
    }
    .btn-ghost{background:#ffffff10}
    .row{display:flex; gap:10px; flex-wrap: wrap; align-items:center}
    .muted{color:var(--muted)}
    .pill{padding:6px 10px; border-radius:999px; background:#ffffff10; border:1px solid #ffffff1e; font-size:12px}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .err{color:var(--err)}
    .katex, mjx-container{font-size: 1.05em}
    canvas{background:#0b1020; border:1px solid #ffffff18; border-radius:14px}
    .table{width:100%; border-collapse: collapse}
    .table th, .table td{border-bottom:1px solid #ffffff12; padding:8px 6px; text-align:left}
    .table th{color:#b9c2ff; font-weight:600}
    .footer{opacity:.7; font-size:12px; text-align:center; padding:20px}
    .tag{font-size:11px; padding:3px 8px; border-radius:8px; background:#ffffff10; border:1px solid #ffffff18; color:#cbd2ff}
    .hidden{display:none}
    .hr{height:1px; background:#ffffff14; margin:10px 0}
    .kbd{font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; background:#00000040; padding:2px 6px; border-radius:6px; border:1px solid #ffffff25}
    .help{font-size:13px; color:#cfd6ff}
  </style>
</head>
<body>
  <header>
    <div class="brand"><div class="logo" aria-hidden="true"></div><h1>ê³ ë“±ìˆ˜í•™ ìˆ˜ì—… ë„ìš°ë¯¸</h1></div>
    <div class="meta">
      <span class="pill">ë‹¨ì¼ íŒŒì¼ Â· ì˜¤í”„ë¼ì¸ ì‘ë™</span>
      <label for="studentName" class="sr-only">í•™ìƒ ì´ë¦„</label>
      <input id="studentName" placeholder="í•™ìƒ ì´ë¦„(ê¸°ë¡ìš©)"/>
      <button class="btn" id="saveName">ì €ì¥</button>
    </div>
  </header>

  <div class="container">
    <aside>
      <button class="section-btn active" data-section="dashboard">ğŸ  ëŒ€ì‹œë³´ë“œ <span class="badge">ê°œìš”</span></button>
      <button class="section-btn" data-section="warmup">âš¡ ë°ì¼ë¦¬ ì›Œë°ì—…</button>
      <button class="section-btn" data-section="quiz">ğŸ§ª í€´ì¦ˆ ìƒì„±ê¸°</button>
      <button class="section-btn" data-section="grapher">ğŸ“ˆ í•¨ìˆ˜ ê·¸ë˜í¼</button>
      <button class="section-btn" data-section="solver">ğŸ§© ì‹/ë°©ì •ì‹ í’€ì´</button>
      <button class="section-btn" data-section="stats">ğŸ“Š í†µê³„ ë†€ì´í„°</button>
      <button class="section-btn" data-section="geometry">ğŸ“ ê¸°í•˜ íƒí—˜</button>
      <button class="section-btn" data-section="flash">ğŸ—‚ï¸ í”Œë˜ì‹œì¹´ë“œ(SR)</button>
      <button class="section-btn" data-section="timer">â±ï¸ ê³µë¶€ íƒ€ì´ë¨¸</button>
      <button class="section-btn" data-section="notes">ğŸ“£ ê³µì§€ Â· ìë£Œ</button>
      <button class="section-btn" data-section="export">ğŸ–¨ï¸ ì¸ì‡„/ë‚´ë³´ë‚´ê¸°</button>
    </aside>

    <main>
      <!-- Dashboard -->
      <section class="card" id="dashboard">
        <h2>ìˆ˜ì—… ê°œìš”</h2>
        <p>ìˆ˜ì—… ìš´ì˜ì„ ìœ„í•œ ë„êµ¬ë“¤ì„ í•œ ê³³ì— ëª¨ì•˜ìŠµë‹ˆë‹¤. ëª¨ë“  ë°ì´í„°ëŠ” <b>ë¸Œë¼ìš°ì €(LocalStorage)</b>ì— ì €ì¥ë©ë‹ˆë‹¤.</p>
        <div class="grid grid-3">
          <div class="card">
            <h3>ë¹ ë¥¸ ì‹œì‘</h3>
            <div class="row">
              <button class="btn" data-jump="warmup">ì›Œë°ì—… ìƒì„±</button>
              <button class="btn" data-jump="quiz">í€´ì¦ˆ ë§Œë“¤ê¸°</button>
              <button class="btn" data-jump="grapher">ê·¸ë˜í”„ ê·¸ë¦¬ê¸°</button>
            </div>
            <p class="help">í‚¤ë³´ë“œ íŒ: <span class="kbd">/</span> ë¡œ ì„¹ì…˜ ê²€ìƒ‰, <span class="kbd">g</span>ë¡œ ê·¸ë˜í¼ ì´ˆì .</p>
          </div>
          <div class="card">
            <h3>ìµœê·¼ ì„±ê³¼</h3>
            <table class="table" id="recentScores"><thead><tr><th>ì´ë¦„</th><th>ì£¼ì œ</th><th>ì ìˆ˜</th><th>ì¼ì‹œ</th></tr></thead><tbody></tbody></table>
          </div>
          <div class="card">
            <h3>ì˜¤ëŠ˜ì˜ í•œ ë¬¸ì œ</h3>
            <div id="dailyProblem"></div>
            <div class="row" style="margin-top:8px">
              <button class="btn" id="newDaily">ìƒˆ ë¬¸ì œ</button>
              <button class="btn-ghost" id="showDaily">ì •ë‹µ ë³´ê¸°</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Warmup -->
      <section class="card hidden" id="warmup">
        <h2>ë°ì¼ë¦¬ ì›Œë°ì—… ìƒì„±ê¸°</h2>
        <p class="muted">ë§¤ì¼ 5ë¶„ ê°œë… ì ê²€. ë‚œì´ë„ì™€ ì£¼ì œë¥¼ ê³ ë¥´ë©´ ëœë¤ ë¬¸ì œê°€ ë‚˜ì™€ìš”.</p>
        <div class="grid grid-3">
          <div class="card">
            <h3>ì„¤ì •</h3>
            <label>ì£¼ì œ</label>
            <select id="wuTopic">
              <option value="linear">ì¼ì°¨ë°©ì •ì‹</option>
              <option value="quad">ì´ì°¨ë°©ì •ì‹</option>
              <option value="system">ì—°ë¦½ë°©ì •ì‹(2x2)</option>
              <option value="func">í•¨ìˆ˜ê°’/í•©ì„±</option>
              <option value="trig">ì‚¼ê°í•¨ìˆ˜ ê¸°ë³¸</option>
              <option value="prob">í™•ë¥  ê¸°ì´ˆ</option>
            </select>
            <label>ë‚œì´ë„</label>
            <select id="wuLevel">
              <option value="1">â˜…</option>
              <option value="2">â˜…â˜…</option>
              <option value="3">â˜…â˜…â˜…</option>
            </select>
            <div class="row" style="margin-top:8px">
              <button class="btn" id="genWarmup">ë¬¸ì œ ìƒì„±</button>
              <button class="btn-ghost" id="revealWarmup">ì •ë‹µ</button>
            </div>
          </div>
          <div class="card" style="grid-column: span 2">
            <h3>ë¬¸ì œ</h3>
            <div id="wuProblem" class="help"></div>
            <div class="hr"></div>
            <label>í’€ì´ ì…ë ¥(ì„ íƒ)</label>
            <textarea id="wuWork" rows="5" placeholder="í’€ì´ ê³¼ì •ì„ ì ì–´ ë³´ì„¸ìš”. ìˆ˜ì‹ì€ $x^2+3x+2$ ì²˜ëŸ¼ ì…ë ¥ ê°€ëŠ¥." style="width:100%"></textarea>
          </div>
        </div>
      </section>

      <!-- Quiz -->
      <section class="card hidden" id="quiz">
        <h2>í€´ì¦ˆ ìƒì„±ê¸°</h2>
        <div class="grid grid-3">
          <div class="card">
            <h3>ì„¤ì •</h3>
            <label>ì£¼ì œ</label>
            <select id="qTopic" aria-label="í€´ì¦ˆ ì£¼ì œ">
              <option value="mixed">í˜¼í•©</option>
              <option value="linear">ì¼ì°¨ë°©ì •ì‹</option>
              <option value="quad">ì´ì°¨ë°©ì •ì‹</option>
              <option value="system">ì—°ë¦½ë°©ì •ì‹(2x2)</option>
              <option value="func">í•¨ìˆ˜ê°’/í•©ì„±</option>
              <option value="trig">ì‚¼ê°í•¨ìˆ˜</option>
              <option value="prob">í™•ë¥ </option>
            </select>
            <label>ë¬¸í•­ ìˆ˜</label>
            <input type="number" id="qCount" min="3" max="20" value="6"/>
            <div class="row" style="margin-top:8px">
              <button class="btn" id="makeQuiz">í€´ì¦ˆ ì‹œì‘</button>
              <button class="btn-ghost" id="endQuiz">ì¢…ë£Œ/ì±„ì </button>
            </div>
          </div>
          <div class="card" style="grid-column: span 2">
            <h3>ë¬¸í•­</h3>
            <ol id="quizItems"></ol>
            <div id="quizResult" class="help"></div>
          </div>
        </div>
      </section>

      <!-- Grapher -->
      <section class="card hidden" id="grapher">
        <h2>í•¨ìˆ˜ ê·¸ë˜í¼</h2>
        <div class="grid grid-2">
          <div class="card">
            <h3>ì„¤ì •</h3>
            <label>í•¨ìˆ˜ ì…ë ¥(ì‰¼í‘œë¡œ ì—¬ëŸ¬ê°œ):</label>
            <input id="fxInput" placeholder="ì˜ˆ: sin(x), x^2-3x+2, e^(0.3x)"/>
            <div class="row">
              <label>ë²”ìœ„ x</label>
              <input id="xMin" type="number" value="-10" style="width:90px">
              <span>~</span>
              <input id="xMax" type="number" value="10" style="width:90px">
            </div>
            <div class="row">
              <button class="btn" id="draw">ê·¸ë¦¬ê¸° (g)</button>
              <button class="btn-ghost" id="resetView">ì´ˆê¸°í™”</button>
            </div>
            <p class="help">ìŠ¤í¬ë¡¤: í™•ëŒ€/ì¶•ì†Œ Â· ë“œë˜ê·¸: íŒ¬ Â· ë”ë¸”í´ë¦­: ì›ì  ë³µê·€</p>
          </div>
          <div class="card">
            <canvas id="plot" width="800" height="480" aria-label="ê·¸ë˜í”„ ì˜ì—­"></canvas>
          </div>
        </div>
      </section>

      <!-- Solver -->
      <section class="card hidden" id="solver">
        <h2>ì‹/ë°©ì •ì‹ í’€ì´</h2>
        <div class="grid grid-3">
          <div class="card">
            <h3>ì¼ì°¨ ë°©ì •ì‹ ax+b=0</h3>
            <div class="row"><input id="la" type="number" value="2" style="width:90px"><span>x +</span><input id="lb" type="number" value="-6" style="width:90px"><span>= 0</span></div>
            <button class="btn" id="solveLinear">í’€ì´</button>
            <div id="linearOut" class="help"></div>
          </div>
          <div class="card">
            <h3>ì´ì°¨ ë°©ì •ì‹ axÂ²+bx+c=0</h3>
            <div class="row"><input id="qa" type="number" value="1" style="width:80px"><span>xÂ² +</span><input id="qb" type="number" value="-3" style="width:80px"><span>x +</span><input id="qc" type="number" value="2" style="width:80px"><span>= 0</span></div>
            <button class="btn" id="solveQuad">í’€ì´</button>
            <div id="quadOut" class="help"></div>
          </div>
          <div class="card">
            <h3>ì—°ë¦½ë°©ì •ì‹ (2Ã—2)</h3>
            <p class="muted">aâ‚x + bâ‚y = câ‚, aâ‚‚x + bâ‚‚y = câ‚‚</p>
            <div class="grid" style="grid-template-columns: repeat(3, 1fr)">
              <input id="a1" type="number" value="2"><input id="b1" type="number" value="1"><input id="c1" type="number" value="5">
              <input id="a2" type="number" value="1"><input id="b2" type="number" value="-1"><input id="c2" type="number" value="1">
            </div>
            <button class="btn" id="solveSys">í’€ì´</button>
            <div id="sysOut" class="help"></div>
          </div>
        </div>
      </section>

      <!-- Stats -->
      <section class="card hidden" id="stats">
        <h2>í†µê³„ ë†€ì´í„°</h2>
        <div class="grid grid-2">
          <div class="card">
            <h3>ë°ì´í„° ì…ë ¥</h3>
            <textarea id="dataInput" rows="7" placeholder="ì‰¼í‘œ ë˜ëŠ” ê³µë°±ìœ¼ë¡œ êµ¬ë¶„: 12, 15, 17, 23, ..." style="width:100%"></textarea>
            <div class="row"><button class="btn" id="analyze">ë¶„ì„</button><button class="btn-ghost" id="randomData">ëœë¤(50)</button></div>
            <div id="statOut" class="help"></div>
          </div>
          <div class="card">
            <h3>íˆìŠ¤í† ê·¸ë¨</h3>
            <canvas id="hist" width="800" height="420"></canvas>
          </div>
        </div>
      </section>

      <!-- Geometry -->
      <section class="card hidden" id="geometry">
        <h2>ê¸°í•˜ íƒí—˜ â€” ì‚¼ê°í˜• ìŠ¬ë¼ì´ë”</h2>
        <div class="grid grid-2">
          <div class="card">
            <h3>ì‚¼ê°í˜• (A ê¸°ì¤€)</h3>
            <label>a(BC) ê¸¸ì´</label>
            <input type="range" id="sideA" min="3" max="20" value="12">
            <label>b(CA) ê¸¸ì´</label>
            <input type="range" id="sideB" min="3" max="20" value="10">
            <label>âˆ A (ë„)</label>
            <input type="range" id="angleA" min="20" max="140" value="60">
            <div class="row" style="margin-top:8px"><span class="tag" id="triInfo">ë‘˜ë ˆ/ë„“ì´</span></div>
          </div>
          <div class="card">
            <canvas id="tri" width="800" height="420"></canvas>
          </div>
        </div>
      </section>

      <!-- Flashcards -->
      <section class="card hidden" id="flash">
        <h2>í”Œë˜ì‹œì¹´ë“œ â€” Leitner ì‹œìŠ¤í…œ</h2>
        <div class="grid grid-2">
          <div class="card">
            <h3>ì¹´ë“œ ì¶”ê°€</h3>
            <input id="fcQ" placeholder="ì§ˆë¬¸/ì •ì˜ (ì˜ˆ: ì™„ì „ì œê³±ì‹ ì „ê°œ)"/>
            <textarea id="fcA" rows="3" placeholder="ì •ë‹µ/ì„¤ëª… (ì˜ˆ: (aÂ±b)^2 = a^2 Â± 2ab + b^2)"></textarea>
            <div class="row"><button class="btn" id="addCard">ì¶”ê°€</button><button class="btn-ghost" id="clearCards">ëª¨ë‘ì‚­ì œ</button></div>
          </div>
          <div class="card">
            <h3>í•™ìŠµ</h3>
            <div id="fcView" class="help">ì¹´ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”.</div>
            <div class="row" style="margin-top:8px">
              <button class="btn-ghost" id="revealCard">ì •ë‹µ</button>
              <button class="btn" id="markEasy">ì‰½ë‹¤(ìŠ¹ê¸‰)</button>
              <button class="btn" id="markHard">ì–´ë µë‹¤(ì´ˆê¸°í™”)</button>
            </div>
            <p class="muted">Leitner: ìƒì1(ë§¤ì¼), ìƒì2(ê²©ì¼), ìƒì3(ì£¼1)</p>
          </div>
        </div>
      </section>

      <!-- Timer -->
      <section class="card hidden" id="timer">
        <h2>ê³µë¶€ íƒ€ì´ë¨¸ (Pomodoro)</h2>
        <div class="row">
          <label>ì§‘ì¤‘(ë¶„)</label><input id="focusMin" type="number" value="25" style="width:90px">
          <label>íœ´ì‹(ë¶„)</label><input id="breakMin" type="number" value="5" style="width:90px">
          <button class="btn" id="startPom">ì‹œì‘</button>
          <button class="btn-ghost" id="stopPom">ì •ì§€</button>
          <span class="tag" id="pomState">ëŒ€ê¸°</span>
        </div>
        <h3 id="pomTime" style="font-size:54px; margin-top:10px">25:00</h3>
        <p class="muted">ì†Œë¦¬ ì—†ìŒ. íƒ­ ì œëª©ì´ ë‚¨ì€ ì‹œê°„ìœ¼ë¡œ ë°”ë€ë‹ˆë‹¤.</p>
      </section>

      <!-- Notes -->
      <section class="card hidden" id="notes">
        <h2>ê³µì§€ Â· ìë£Œ</h2>
        <div class="grid grid-2">
          <div class="card">
            <h3>ìƒˆ ê³µì§€</h3>
            <input id="noteTitle" placeholder="ì œëª©"/>
            <textarea id="noteBody" rows="4" placeholder="ë‚´ìš©(ë§í¬/ê³¼ì œ ë“±)"></textarea>
            <button class="btn" id="addNote">ë“±ë¡</button>
          </div>
          <div class="card">
            <h3>ëª©ë¡</h3>
            <ul id="noteList"></ul>
          </div>
        </div>
      </section>

      <!-- Export -->
      <section class="card hidden" id="export">
        <h2>ì¸ì‡„/ë‚´ë³´ë‚´ê¸°</h2>
        <p>í˜„ì¬ ì›Œë°ì—…/í€´ì¦ˆ ë¬¸ì œë“¤ì„ í•œ ì¥ìœ¼ë¡œ ëª¨ì•„ <b>ì¸ì‡„</b>í•˜ê±°ë‚˜ PDFë¡œ ì €ì¥í•˜ì„¸ìš”.</p>
        <div class="row">
          <button class="btn" id="printPage">ì¸ì‡„/PDF</button>
          <button class="btn-ghost" id="exportJSON">ë°ì´í„°(JSON) ë‚´ë³´ë‚´ê¸°</button>
          <input type="file" id="importJSON" accept="application/json" style="display:none">
          <button class="btn-ghost" id="importBtn">ê°€ì ¸ì˜¤ê¸°</button>
        </div>
        <pre id="jsonBox" class="help" style="white-space: pre-wrap"></pre>
      </section>

      <div class="footer">Â© 2025 ìˆ˜ì—… ë„ìš°ë¯¸ Â· ë‹¨ì¼ HTML íŒŒì¼ | ë‹¨ì¶•í‚¤ <span class="kbd">/</span> ì„¹ì…˜ ê²€ìƒ‰</div>
    </main>
  </div>

  <script>
    // ---------- ìœ í‹¸ ----------
    const $ = (q, el=document) => el.querySelector(q);
    const $$ = (q, el=document) => [...el.querySelectorAll(q)];
    const fmt = n => Number.isInteger(n)? n.toString() : n.toFixed(3).replace(/\.0+$/,'');
    const nowStr = () => new Date().toLocaleString();

    const store = {
      get(k, def){ try{ return JSON.parse(localStorage.getItem(k)) ?? def }catch{ return def }},
      set(k, v){ localStorage.setItem(k, JSON.stringify(v)) }
    };

    // ---------- ë„¤ë¹„ê²Œì´ì…˜ ----------
    const sections = $$('.section-btn');
    const showSection = id => {
      $$('#main > section'); // no-op for readability
      $$('main > section').forEach(s=> s.classList.add('hidden'));
      $('#'+id).classList.remove('hidden');
      sections.forEach(b=> b.classList.toggle('active', b.dataset.section===id));
      history.replaceState(null,'', '#'+id);
      const map = {grapher:'ê·¸ë˜í”„', quiz:'í€´ì¦ˆ', warmup:'ì›Œë°ì—…'};
      if (id==='grapher') $('#fxInput')?.focus();
    };
    sections.forEach(btn=> btn.addEventListener('click', ()=> showSection(btn.dataset.section)));
    $$('[data-jump]').forEach(b=> b.onclick=()=> showSection(b.dataset.jump));

    // ì£¼ì†Œ í•´ì‹œë¡œ ì´ˆê¸° ì„¹ì…˜ ê²°ì •
    window.addEventListener('load', ()=>{
      const id = location.hash?.slice(1) || 'dashboard';
      showSection(id);
    });

    // ---------- í•™ìƒ ì´ë¦„ ì €ì¥ ----------
    const nameBox = $('#studentName');
    nameBox.value = store.get('studentName','');
    $('#saveName').onclick = ()=> { store.set('studentName', nameBox.value.trim()); alert('ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.'); };

    // ---------- ì˜¤ëŠ˜ì˜ í•œ ë¬¸ì œ ----------
    const rnd = (a,b)=> Math.floor(Math.random()*(b-a+1))+a;
    function renderMath(el){ if (window.MathJax) MathJax.typesetPromise([el]); }

    const gen = {
      linear(level=1){
        let a = rnd(1,9)*(Math.random()<.5?-1:1), b = rnd(-10,10);
        if (a===0) a=1;
        const x = -b/a;
        return { t:`ì¼ì°¨ë°©ì •ì‹ $${a}x${b<0?'':'+'}${b}=0$ ì˜ í•´ë¥¼ êµ¬í•˜ì‹œì˜¤.`, ans:`$x=${fmt(x)}$` };
      },
      quad(level=1){
        // ì¸ìˆ˜ë¶„í•´ ê°€ëŠ¥í•œ ì¼€ì´ìŠ¤ ìš°ì„ 
        const r1 = rnd(-6,6) || 1, r2 = rnd(-6,6) || -2; // í•´
        const a = rnd(1,3)*(Math.random()<.5?-1:1);
        const b = -a*(r1+r2), c = a*r1*r2;
        return { t:`ì´ì°¨ë°©ì •ì‹ $${a}x^2${b<0?'':'+'}${b}x${c<0?'':'+'}${c}=0$ ì˜ ê·¼ì„ êµ¬í•˜ì‹œì˜¤.`, ans:`$x=${fmt(r1)},~${fmt(r2)}$` };
      },
      system(){
        const x=rnd(-5,5), y=rnd(-5,5);
        const a1=rnd(1,6), b1=rnd(1,6), a2=rnd(1,6), b2=rnd(1,6);
        const c1=a1*x+b1*y, c2=a2*x+b2*y;
        return { t:`ì—°ë¦½ $\\begin{cases} ${a1}x+${b1}y=${c1} \\ ${a2}x+${b2}y=${c2} \\end{cases}$ ì˜ í•´ $(x,y)$`, ans:`$(x,y)=(${x},~${y})$` };
      },
      func(){
        const a=rnd(1,4), b=rnd(-3,3), x=rnd(-3,3);
        return { t:`$f(x)=${a}x${b<0?'':'+'}${b}$ ì¼ ë•Œ $f(${x})$`, ans:`$${a}\\times ${x}${b<0?'':'+'}${b}=${fmt(a*x+b)}$` };
      },
      trig(){
        const k = [30,45,60][rnd(0,2)], rad=(k*Math.PI/180);
        const which = rnd(0,2); // 0:sin 1:cos 2:tan
        const names=['sin','cos','tan'];
        const val = which===0? Math.sin(rad): which===1? Math.cos(rad): Math.tan(rad);
        const target = names[which];
        return { t:`$${target}(${k}^{\\circ})$ ì˜ ê°’ì„ êµ¬í•˜ì‹œì˜¤.`, ans:`$${target}(${k}^{\\circ})=${fmt(val)}$` };
      },
      prob(){
        const total=rnd(4,10), good=rnd(1,total-1);
        return { t:`ìƒìì— êµ¬ìŠ¬ ${total}ê°œ ì¤‘ ì¢‹ì€ ê²ƒ ${good}ê°œ. í•˜ë‚˜ ë½‘ì„ ë•Œ ì¢‹ì€ ê²ƒì¼ í™•ë¥ ì€?`, ans:`$${good}/${total}=${fmt(good/total)}$` };
      }
    };

    function newDaily(){
      const topics=['linear','quad','system','func','trig','prob'];
      const k = topics[rnd(0, topics.length-1)];
      const p = gen[k]();
      $('#dailyProblem').dataset.answer = p.ans;
      $('#dailyProblem').innerHTML = `<div class="pill">${k}</div> ${p.t}`;
      renderMath($('#dailyProblem'));
    }
    newDaily();
    $('#newDaily').onclick = newDaily;
    $('#showDaily').onclick = ()=>{
      const dp = $('#dailyProblem');
      if (dp.dataset.answer) dp.innerHTML += `<div class='help' style='margin-top:6px'>ì •ë‹µ: ${dp.dataset.answer}</div>`;
      renderMath(dp);
    };

    // ---------- ì›Œë°ì—… ----------
    $('#genWarmup').onclick = ()=>{
      const t = $('#wuTopic').value, lv = +$('#wuLevel').value;
      const p = gen[t](lv);
      $('#wuProblem').innerHTML = p.t + `<div class='hr'></div><div class='muted'>ì •ë‹µì€ 'ì •ë‹µ' ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>`;
      $('#wuProblem').dataset.answer = p.ans;
      renderMath($('#wuProblem'));
    };
    $('#revealWarmup').onclick = ()=>{
      const el = $('#wuProblem');
      if (el.dataset.answer) el.innerHTML += `<div style='margin-top:8px'>ì •ë‹µ: ${el.dataset.answer}</div>`;
      renderMath(el);
    };

    // ---------- í€´ì¦ˆ ----------
    let currentQuiz = [];
    function makeOne(topic){
      if (topic==='mixed'){
        const keys = Object.keys(gen);
        return gen[keys[rnd(0, keys.length-1)]]();
      }
      return gen[topic]();
    }

    function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=rnd(0,i); [a[i],a[j]]=[a[j],a[i]] } return a }

    function startQuiz(){
      const topic = $('#qTopic').value, n = Math.max(3, Math.min(20, +$('#qCount').value||6));
      currentQuiz = [];
      const list = $('#quizItems'); list.innerHTML='';
      for (let i=0;i<n;i++){
        const base = makeOne(topic);
        const ansText = base.ans.replace(/\$|\s|,|~|\(|\)/g,''); // crude normalize
        // ê°ê´€ì‹ ë³´ê¸° ìƒì„±: ì •ë‹µ ë³€í˜•
        const options = [base.ans];
        for (let k=0;k<3;k++){
          options.push(base.ans.replace(/([0-9]+\.?[0-9]*)/, (m)=> (parseFloat(m)+(rnd(-3,3)||1))));
        }
        shuffle(options);
        const id = 'q'+i;
        const li = document.createElement('li');
        li.innerHTML = `<div class='card'>${base.t}<div style='margin:8px 0'></div>`+
          options.map((op,j)=>`<label style='display:block; margin:6px 0'><input type='radio' name='${id}' value='${op}'> ${op}</label>`).join('')+
          `</div>`;
        list.appendChild(li);
        currentQuiz.push({q:base.t, ans: base.ans, id});
      }
      renderMath($('#quiz'));
      $('#quizResult').textContent='';
    }

    $('#makeQuiz').onclick = startQuiz;
    $('#endQuiz').onclick = ()=>{
      if (!currentQuiz.length) return;
      let score=0, detail=[];
      currentQuiz.forEach((item,i)=>{
        const sel = document.querySelector(`input[name='${item.id}']:checked`);
        const picked = sel? sel.value: '(ë¬´ì‘ë‹µ)';
        const ok = picked===item.ans; if (ok) score++;
        detail.push({no:i+1, ok, picked, ans:item.ans});
      });
      const msg = `ì •ë‹µ ${score}/${currentQuiz.length} ë¬¸í•­`;
      $('#quizResult').innerHTML = `<b>${msg}</b>`+
        `<table class='table'><thead><tr><th>#</th><th>ì„ íƒ</th><th>ì •ë‹µ</th><th>ê²°ê³¼</th></tr></thead><tbody>`+
        detail.map(d=>`<tr><td>${d.no}</td><td>${d.picked}</td><td>${d.ans}</td><td>${d.ok? 'âœ…':'âŒ'}</td></tr>`).join('')+
        `</tbody></table>`;
      // ê¸°ë¡ ì €ì¥
      const rec = store.get('scores',[]);
      rec.unshift({name: store.get('studentName','-'), topic: $('#qTopic').value, score:`${score}/${currentQuiz.length}`, at: nowStr()});
      store.set('scores', rec.slice(0,50));
      loadRecent();
      renderMath($('#quizResult'));
    };

    function loadRecent(){
      const rec = store.get('scores',[]);
      const tb = $('#recentScores tbody'); tb.innerHTML='';
      rec.slice(0,8).forEach(r=>{
        const tr=document.createElement('tr');
        tr.innerHTML = `<td>${r.name||'-'}</td><td>${r.topic}</td><td>${r.score}</td><td>${r.at}</td>`;
        tb.appendChild(tr);
      })
    }
    loadRecent();

    // ---------- ê·¸ë˜í¼ ----------
    const plot = $('#plot'); const ctx = plot.getContext('2d');
    let view = {xmin:-10,xmax:10,ymin:-6,ymax:6};

    function toPx(x,y){
      const w=plot.width, h=plot.height;
      const X = (x-view.xmin)/(view.xmax-view.xmin)*w;
      const Y = h - (y-view.ymin)/(view.ymax-view.ymin)*h;
      return [X,Y];
    }
    function toXY(X,Y){
      const w=plot.width, h=plot.height;
      const x = view.xmin + (X/w)*(view.xmax-view.xmin);
      const y = view.ymin + ((h-Y)/h)*(view.ymax-view.ymin);
      return [x,y];
    }
    function drawAxes(){
      ctx.clearRect(0,0,plot.width,plot.height);
      // grid
      ctx.lineWidth=1; ctx.strokeStyle='#ffffff16';
      const step = niceStep((view.xmax-view.xmin)/10);
      for(let x=Math.ceil(view.xmin/step)*step; x<=view.xmax; x+=step){
        const [X] = toPx(x,0); ctx.beginPath(); ctx.moveTo(X,0); ctx.lineTo(X,plot.height); ctx.stroke();
      }
      for(let y=Math.ceil(view.ymin/step)*step; y<=view.ymax; y+=step){
        const [,Y] = toPx(0,y); ctx.beginPath(); ctx.moveTo(0,Y); ctx.lineTo(plot.width,Y); ctx.stroke();
      }
      // axes
      ctx.strokeStyle='#ffffff55'; ctx.lineWidth=1.4;
      const [X0] = toPx(0,0), [,Y0] = toPx(0,0);
      ctx.beginPath(); ctx.moveTo(X0,0); ctx.lineTo(X0,plot.height); ctx.stroke();
      ctx.beginPath(); ctx.moveTo(0,Y0); ctx.lineTo(plot.width,Y0); ctx.stroke();
    }
    function niceStep(range){
      const raw = range/8; const p = Math.pow(10, Math.floor(Math.log10(raw)));
      const m = raw/p; if (m<1.5) return 1*p; if (m<3.5) return 2*p; if (m<7.5) return 5*p; return 10*p;
    }

    function parseFx(str){
      // ì•ˆì „í•˜ì§€ ì•Šì€ evalì„ í”¼í•˜ê¸° ìœ„í•´ ì œí•œëœ ìˆ˜í•™ë§Œ í—ˆìš©
      const safe = str.replace(/\^/g,'**')
        .replace(/(sin|cos|tan|log|ln|sqrt|abs|exp)\(/g,'Math.$1('.replace('ln(','log('))
        .replace(/e\^/g,'exp(');
      return x=>{ try{ with(Math){ return eval(safe) } }catch{ return NaN } };
    }

    function plotFx(fx){
      ctx.strokeStyle = '#8b9cff'; ctx.lineWidth=2; ctx.beginPath();
      let first=true;
      for(let i=0;i<plot.width;i++){
        const [x] = toXY(i,0); const y = fx(x);
        const [X,Y] = toPx(x,y);
        if (!isFinite(Y)) { first=true; continue; }
        if (first){ ctx.moveTo(i,Y); first=false } else ctx.lineTo(i,Y);
      }
      ctx.stroke();
    }

    function drawAll(){
      drawAxes();
      const expr = $('#fxInput').value;
      if (!expr.trim()) return;
      expr.split(',').map(s=>s.trim()).forEach(s=> plotFx(parseFx(s)));
    }

    $('#draw').onclick = ()=>{
      view.xmin=+$('#xMin').value; view.xmax=+$('#xMax').value; drawAll();
    };
    $('#resetView').onclick = ()=>{ view={xmin:-10,xmax:10,ymin:-6,ymax:6}; $('#xMin').value=-10; $('#xMax').value=10; drawAll(); };

    // ì¸í„°ë™ì…˜: íŒ¬/ì¤Œ
    let isDrag=false, last=
      {x:0,y:0};
    plot.addEventListener('mousedown',e=>{ isDrag=true; last={x:e.offsetX,y:e.offsetY} });
    plot.addEventListener('mouseup',()=> isDrag=false);
    plot.addEventListener('mouseleave',()=> isDrag=false);
    plot.addEventListener('mousemove',e=>{
      if(!isDrag) return;
      const dx=e.offsetX-last.x, dy=e.offsetY-last.y; last={x:e.offsetX,y:e.offsetY};
      const [dxv, dyv] = [-(dx/plot.width)*(view.xmax-view.xmin), (dy/plot.height)*(view.ymax-view.ymin)];
      view.xmin+=dxv; view.xmax+=dxv; view.ymin+=dyv; view.ymax+=dyv; drawAll();
    });
    plot.addEventListener('wheel',e=>{
      e.preventDefault();
      const scale = (e.deltaY>0? 1.1: 0.9);
      const [mx,my] = toXY(e.offsetX,e.offsetY);
      view.xmin = mx + (view.xmin-mx)*scale;
      view.xmax = mx + (view.xmax-mx)*scale;
      view.ymin = my + (view.ymin-my)*scale;
      view.ymax = my + (view.ymax-my)*scale;
      drawAll();
    }, {passive:false});
    plot.addEventListener('dblclick',()=>{ view={xmin:-10,xmax:10,ymin:-6,ymax:6}; drawAll(); });
    // ë‹¨ì¶•í‚¤
    document.addEventListener('keydown',e=>{ if(e.key==='g'){ $('#fxInput').focus(); } });

    // ì´ˆê¸° ê·¸ë¦¬ê¸°
    $('#fxInput').value = 'sin(x), x^2-3x+2'; drawAll();

    // ---------- Solver ----------
    $('#solveLinear').onclick = ()=>{
      const a=+$('#la').value, b=+$('#lb').value; if(a===0){ $('#linearOut').textContent='aâ‰ 0 ì´ì–´ì•¼ í•©ë‹ˆë‹¤.'; return; }
      const x=-b/a; $('#linearOut').innerHTML = `í•´: $x=${fmt(x)}$ <br>ê³¼ì •: $${a}x${b<0?'':'+'}${b}=0 \\Rightarrow x= -${b}/${a}$`;
      renderMath($('#linearOut'));
    };
    $('#solveQuad').onclick = ()=>{
      const a=+$('#qa').value, b=+$('#qb').value, c=+$('#qc').value; if(a===0){ $('#quadOut').textContent='aâ‰ 0 ì´ì–´ì•¼ í•©ë‹ˆë‹¤.'; return; }
      const D=b*b-4*a*c; let msg=`íŒë³„ì‹ $D=b^2-4ac=${b*b}-4\\cdot${a}\\cdot${c}=${D}$`;
      if (D<0) msg += '<br>ì‹¤ê·¼ì´ ì—†ìŠµë‹ˆë‹¤.'; else {
        const r1=(-b+Math.sqrt(D))/(2*a), r2=(-b-Math.sqrt(D))/(2*a);
        msg += `<br>í•´: $x=${fmt(r1)},~${fmt(r2)}$`;
      }
      $('#quadOut').innerHTML = msg; renderMath($('#quadOut'));
    };
    $('#solveSys').onclick = ()=>{
      const a1=+$('#a1').value, b1=+$('#b1').value, c1=+$('#c1').value, a2=+$('#a2').value, b2=+$('#b2').value, c2=+$('#c2').value;
      const det=a1*b2-a2*b1; if(det===0){ $('#sysOut').textContent='í•´ê°€ í•˜ë‚˜ë¡œ ì •í•´ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.(det=0)'; return; }
      const x=(c1*b2-c2*b1)/det, y=(a1*c2-a2*c1)/det;
      $('#sysOut').innerHTML = `Cramer: det=${fmt(det)}, $x=${fmt(x)},~y=${fmt(y)}$`;
      renderMath($('#sysOut'));
    };

    // ---------- í†µê³„ ----------
    function parseNums(s){ return s.split(/[^-0-9.]+/).map(Number).filter(v=>!isNaN(v)); }
    function mean(a){ return a.reduce((p,c)=>p+c,0)/a.length }
    function median(a){ const b=[...a].sort((x,y)=>x-y); const m=Math.floor(b.length/2); return b.length%2? b[m] : (b[m-1]+b[m])/2 }
    function mode(a){ const m=new Map(); a.forEach(v=>m.set(v,(m.get(v)||0)+1)); let best=null,c=0; m.forEach((n,k)=>{ if(n>c){c=n;best=k} }); return best }
    function stdev(a){ const m=mean(a); return Math.sqrt(mean(a.map(v=>(v-m)**2))) }

    function drawHist(values){
      const cvs=$('#hist'), c=cvs.getContext('2d'); c.clearRect(0,0,cvs.width,cvs.height);
      if (!values.length) return;
      const n=10, min=Math.min(...values), max=Math.max(...values), w=(max-min)/n;
      const bins=new Array(n).fill(0);
      values.forEach(v=>{ let i=Math.min(n-1, Math.floor((v-min)/w)); bins[i]++ });
      const H=Math.max(...bins);
      // axes
      c.strokeStyle='#ffffff55'; c.lineWidth=1.2; c.beginPath(); c.moveTo(40,10); c.lineTo(40,400); c.lineTo(780,400); c.stroke();
      // bars
      const bw=(780-40)/n; c.fillStyle='#8b9cffaa';
      bins.forEach((b,i)=>{
        const h=b/H*360; c.fillRect(40+i*bw, 400-h, bw-4, h);
      });
    }

    $('#analyze').onclick = ()=>{
      const arr = parseNums($('#dataInput').value);
      if (!arr.length){ $('#statOut').textContent='ë°ì´í„°ë¥¼ ì…ë ¥í•˜ì„¸ìš”.'; drawHist([]); return; }
      const m=mean(arr), med=median(arr), mo=mode(arr), sd=stdev(arr);
      $('#statOut').innerHTML = `n=${arr.length}, í‰ê· =${fmt(m)}, ì¤‘ì•™ê°’=${fmt(med)}, ìµœë¹ˆê°’=${fmt(mo)}, í‘œì¤€í¸ì°¨=${fmt(sd)}`;
      drawHist(arr);
    };
    $('#randomData').onclick = ()=>{
      const a=[...Array(50)].map(()=> Math.round(rnd(40,100)+Math.random()*10));
      $('#dataInput').value = a.join(', ');
      $('#analyze').click();
    };

    // ---------- ê¸°í•˜: ì‚¼ê°í˜• ----------
    const tri = $('#tri'); const tc = tri.getContext('2d');
    function drawTri(){
      const a=+$('#sideA').value, b=+$('#sideB').value, A=(+$('#angleA').value)*Math.PI/180;
      // ì½”ì‚¬ì¸ ë²•ì¹™ìœ¼ë¡œ c ê³„ì‚°
      const c = Math.sqrt(a*a+b*b - 2*a*b*Math.cos(A));
      const s = 0.5*a*b*Math.sin(A);
      $('#triInfo').textContent = `câ‰ˆ${fmt(c)}, ë‘˜ë ˆâ‰ˆ${fmt(a+b+c)}, ë„“ì´â‰ˆ${fmt(s)}`;
      tc.clearRect(0,0,tri.width,tri.height);
      // ì¢Œí‘œ ë°°ì¹˜
      const scale = 18; const origin = {x:100, y:340};
      const Ax=origin.x, Ay=origin.y;
      const Bx=Ax + a*scale, By=Ay;
      const Cx=Ax + b*scale*Math.cos(A), Cy=Ay - b*scale*Math.sin(A);
      // grid
      tc.strokeStyle='#ffffff12';
      for(let x=0;x<tri.width;x+=40){ tc.beginPath(); tc.moveTo(x,0); tc.lineTo(x,tri.height); tc.stroke(); }
      for(let y=0;y<tri.height;y+=40){ tc.beginPath(); tc.moveTo(0,y); tc.lineTo(tri.width,y); tc.stroke(); }
      // triangle
      tc.strokeStyle='#8b9cff'; tc.lineWidth=2;
      tc.beginPath(); tc.moveTo(Ax,Ay); tc.lineTo(Bx,By); tc.lineTo(Cx,Cy); tc.closePath(); tc.stroke();
      // vertices
      tc.fillStyle='#44d4c2'; [ [Ax,Ay,'A'],[Bx,By,'B'],[Cx,Cy,'C'] ].forEach(([x,y,l])=>{ tc.beginPath(); tc.arc(x,y,4,0,Math.PI*2); tc.fill(); tc.fillText(l, x+6,y-6); });
    }
    ['sideA','sideB','angleA'].forEach(id=> $('#'+id).addEventListener('input', drawTri));
    drawTri();

    // ---------- í”Œë˜ì‹œì¹´ë“œ ----------
    function loadCards(){ return store.get('cards',[]); }
    function saveCards(a){ store.set('cards', a); }
    function pickCard(){
      const cards=loadCards();
      if(!cards.length){ $('#fcView').textContent='ì¹´ë“œë¥¼ ì¶”ê°€í•˜ì„¸ìš”.'; return }
      // ê°„ë‹¨ Leitner: due(ë‹¤ìŒ ë³µìŠµ ì‹œê°) ê¸°ì¤€
      const now=Date.now();
      const due = cards.filter(c=> (c.due||0)<=now);
      const pool = due.length? due : cards;
      const c = pool[Math.floor(Math.random()*pool.length)];
      $('#fcView').innerHTML = `<b>Q.</b> ${c.q}<div class='hr'></div><div class='muted'>ì •ë‹µ ë³´ê¸° ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.</div>`;
      $('#fcView').dataset.card = c.id;
    }
    function schedule(box){
      const now=Date.now();
      if (box===1) return now + 24*3600*1000; // 1ì¼
      if (box===2) return now + 48*3600*1000; // 2ì¼
      return now + 7*24*3600*1000; // ì¼ì£¼ì¼
    }
    $('#addCard').onclick = ()=>{
      const q=$('#fcQ').value.trim(), a=$('#fcA').value.trim(); if(!q||!a) return;
      const cards=loadCards();
      cards.push({id:crypto.randomUUID(), q, a, box:1, due: Date.now()});
      saveCards(cards); $('#fcQ').value=''; $('#fcA').value=''; pickCard();
    };
    $('#clearCards').onclick = ()=>{ if(confirm('ëª¨ë“  ì¹´ë“œë¥¼ ì‚­ì œí• ê¹Œìš”?')){ saveCards([]); $('#fcView').textContent='ëª¨ë‘ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.'; } };
    $('#revealCard').onclick = ()=>{
      const id=$('#fcView').dataset.card; if(!id) return;
      const cards=loadCards(); const c=cards.find(x=>x.id===id); if(!c) return;
      $('#fcView').innerHTML += `<div style='margin-top:8px'><b>A.</b> ${c.a}</div>`;
    };
    $('#markEasy').onclick = ()=>{
      const id=$('#fcView').dataset.card; if(!id) return;
      const cards=loadCards(); const c=cards.find(x=>x.id===id); if(!c) return;
      c.box = Math.min(3, (c.box||1)+1); c.due = schedule(c.box); saveCards(cards); pickCard();
    };
    $('#markHard').onclick = ()=>{
      const id=$('#fcView').dataset.card; if(!id) return;
      const cards=loadCards(); const c=cards.find(x=>x.id===id); if(!c) return;
      c.box = 1; c.due = schedule(c.box); saveCards(cards); pickCard();
    };
    pickCard();

    // ---------- íƒ€ì´ë¨¸ ----------
    let timer=null, remain=0, mode='focus';
    function tick(){ if(remain<=0){
        if(mode==='focus'){ mode='break'; remain=+$('#breakMin').value*60; $('#pomState').textContent='íœ´ì‹'; }
        else { mode='focus'; remain=+$('#focusMin').value*60; $('#pomState').textContent='ì§‘ì¤‘'; }
      }
      remain--; const m=Math.floor(remain/60), s=remain%60; $('#pomTime').textContent=`${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`; document.title=`${$('#pomTime').textContent} Â· ìˆ˜ì—… ë„ìš°ë¯¸`;
    }
    $('#startPom').onclick = ()=>{ clearInterval(timer); mode='focus'; remain=+$('#focusMin').value*60; $('#pomState').textContent='ì§‘ì¤‘'; timer=setInterval(tick,1000); };
    $('#stopPom').onclick = ()=>{ clearInterval(timer); $('#pomState').textContent='ëŒ€ê¸°'; document.title='ê³ ë“±ìˆ˜í•™ ìˆ˜ì—… ë„ìš°ë¯¸'; };

    // ---------- ê³µì§€ ----------
    function loadNotes(){ return store.get('notes',[]); }
    function saveNotes(a){ store.set('notes', a); }
    function renderNotes(){ const ul=$('#noteList'); ul.innerHTML=''; loadNotes().forEach(n=>{
      const li=document.createElement('li');
      li.className='card';
      li.innerHTML = `<b>${n.title}</b> <span class='pill'>${n.at}</span><div class='muted' style='margin-top:6px'>${n.body}</div>`+
        `<div class='row' style='margin-top:6px'><button class='btn-ghost' data-id='${n.id}'>ì‚­ì œ</button></div>`;
      ul.appendChild(li);
    });
      // ì‚­ì œ í•¸ë“¤ëŸ¬
      $$(`#noteList .btn-ghost`).forEach(b=> b.onclick=()=>{ const id=b.dataset.id; const a=loadNotes().filter(x=>x.id!==id); saveNotes(a); renderNotes(); });
    }
    $('#addNote').onclick = ()=>{
      const title=$('#noteTitle').value.trim(), body=$('#noteBody').value.trim(); if(!title) return;
      const a=loadNotes(); a.unshift({id:crypto.randomUUID(), title, body, at: nowStr()}); saveNotes(a); $('#noteTitle').value=''; $('#noteBody').value=''; renderNotes();
    };
    renderNotes();

    // ---------- ë‚´ë³´ë‚´ê¸° ----------
    $('#printPage').onclick = ()=> window.print();
    $('#exportJSON').onclick = ()=>{
      const data = {
        studentName: store.get('studentName',''),
        scores: store.get('scores',[]),
        cards: store.get('cards',[]),
        notes: store.get('notes',[])
      };
      const s = JSON.stringify(data, null, 2); $('#jsonBox').textContent = s;
      const blob = new Blob([s], {type:'application/json'}); const url = URL.createObjectURL(blob);
      const a=document.createElement('a'); a.href=url; a.download='math-helper-export.json'; a.click(); URL.revokeObjectURL(url);
    };
    $('#importBtn').onclick = ()=> $('#importJSON').click();
    $('#importJSON').addEventListener('change', async (e)=>{
      const file=e.target.files[0]; if(!file) return; const txt=await file.text();
      try{ const data=JSON.parse(txt); ['studentName','scores','cards','notes'].forEach(k=>{ if(data[k]) store.set(k,data[k]) }); alert('ê°€ì ¸ì˜¤ê¸° ì™„ë£Œ'); location.reload(); }catch{ alert('ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨'); }
    });

    // ---------- ì „ì—­ ë‹¨ì¶•í‚¤: ì„¹ì…˜ ê²€ìƒ‰ ----------
    document.addEventListener('keydown', (e)=>{
      if (e.key==='/'){
        e.preventDefault();
        const q = prompt('ì´ë™í•  ì„¹ì…˜(ì˜ˆ: ê·¸ë˜í”„, í€´ì¦ˆ, ì›Œë°ì—…, í†µê³„, ê¸°í•˜, í”Œë˜ì‹œ, íƒ€ì´ë¨¸, ê³µì§€, ì¸ì‡„):');
        if (!q) return;
        const map = { 'ê·¸ë˜í”„':'grapher','í€´ì¦ˆ':'quiz','ì›Œë°ì—…':'warmup','í†µê³„':'stats','ê¸°í•˜':'geometry','í”Œë˜ì‹œ':'flash','íƒ€ì´ë¨¸':'timer','ê³µì§€':'notes','ì¸ì‡„':'export' };
        showSection(map[q]||'dashboard');
      }
    });
  </script>
</body>
</html>
